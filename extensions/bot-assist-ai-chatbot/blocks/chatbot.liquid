{% comment %}
  BotAssist Chatbot App Embed
{% endcomment %}

{% if shop.metafields.botassist.api_key != blank %}
<script>
  fetch('https://api.botassistai.com/public/get-api-key?shop={{ shop.permanent_domain }}')
    .then(res => res.json())
    .then(data => {
      if (!data.apiKey) {
        console.error("❌ Missing API key");
        return;
      }

      const s = document.createElement("script");
      s.src = "{{ 'chatbot-loader.js' | asset_url }}";
      s.setAttribute("data-api-key", data.apiKey);
      s.setAttribute("data-shop", "{{ shop.permanent_domain }}");
      s.defer = true;
      document.body.appendChild(s);
    })
    .catch(err => console.error("❌ BotAssist init failed", err));
</script>

{% else %}
  <script>console.error("❌ BotAssist API key missing for this shop")</script>
{% endif %}


{% schema %}
{
  "name": "BotAssist Chatbot",
  "target": "body",
  "settings": [
    {
      "type": "text",
      "id": "welcome_message",
      "label": "Welcome message",
      "default": "Hi! How can I help you?"
    },
    {
      "type": "color",
      "id": "chatbot_background",
      "label": "Chatbot Background Color",
      "default": "#092032"
    }
  ]
}
{% endschema %}
