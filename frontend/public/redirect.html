<!DOCTYPE html>
<html>
  <head><meta charset="utf-8"><title>Redirecting…</title></head>
  <body style="text-align:center;margin-top:30vh;font-family:sans-serif">
    <h3>Redirecting…</h3>
    <script>
      const url = new URL(location.href);
      const params = url.searchParams;
    
      const target = params.get("target");
      const shop = params.get("shop");
    
      if (target) {
        location.replace(target);
      } else if (shop) {
        location.replace(
          `https://api.botassistai.com/shopify/top-level-auth?shop=${encodeURIComponent(shop)}`
        );
      } else {
        // Try to recover via Shopify
        const fallback = url.searchParams.get("origin") || "/?shopify_repair=1";
        location.replace(fallback);
      }
    </script>
    
  </body>
</html>
